# План реализации программы ChatList

## Этап 1: Настройка проекта и базы данных

### 1.1 Инициализация проекта
- [ ] Создать структуру директорий проекта
- [ ] Создать файл `requirements.txt` с зависимостями:
  - PyQt5
  - requests или httpx
  - python-dotenv (для работы с .env)
- [ ] Создать файл `.env.example` с примерами переменных окружения
- [ ] Создать файл `.gitignore` (исключить .env, __pycache__, *.db)

### 1.2 Создание модуля базы данных (db.py)
- [ ] Реализовать класс `Database` для работы с SQLite
- [ ] Создать метод `init_db()` для инициализации БД и создания таблиц:
  - `prompts` (id, date, prompt, tags)
  - `models` (id, name, api_url, api_id, is_active)
  - `results` (id, prompt_id, model_id, response, selected, created_at)
  - `settings` (id, key, value)
- [ ] Реализовать методы CRUD для каждой таблицы:
  - `create_prompt()`, `get_prompts()`, `update_prompt()`, `delete_prompt()`
  - `create_model()`, `get_models()`, `get_active_models()`, `update_model()`, `delete_model()`
  - `save_results()`, `get_results()`, `delete_result()`
  - `get_setting()`, `set_setting()`
- [ ] Добавить методы поиска и сортировки для всех таблиц

## Этап 2: Работа с API нейросетей

### 2.1 Создание модуля network.py
- [ ] Реализовать базовый класс `APIClient` для работы с API
- [ ] Создать классы-наследники для разных типов моделей:
  - `OpenAIClient` (OpenAI API)
  - `DeepSeekClient` (DeepSeek API)
  - `GroqClient` (Groq API)
  - Базовый класс для расширяемости
- [ ] Реализовать метод `send_request(prompt: str) -> str` для каждого клиента
- [ ] Добавить обработку ошибок и таймаутов
- [ ] Реализовать асинхронную отправку запросов (опционально, для ускорения)

### 2.2 Интеграция с моделями
- [ ] Создать модуль `models.py` для работы с конфигурацией моделей
- [ ] Реализовать класс `ModelManager`:
  - Загрузка списка моделей из БД
  - Создание соответствующих API-клиентов
  - Управление активными моделями
- [ ] Реализовать метод `send_to_all_models(prompt: str) -> List[Result]`
- [ ] Добавить логирование запросов и ответов

## Этап 3: Основной интерфейс (main.py)

### 3.1 Создание главного окна
- [ ] Расширить класс `MainWindow` из базового шаблона
- [ ] Создать layout с основными секциями:
  - Панель ввода промта
  - Список сохраненных промтов
  - Таблица результатов
  - Панель управления

### 3.2 Панель ввода промта
- [ ] Добавить текстовое поле (QTextEdit) для ввода промта
- [ ] Добавить поле для тегов (QLineEdit)
- [ ] Добавить кнопку "Отправить запрос"
- [ ] Добавить выпадающий список (QComboBox) для выбора сохраненного промта
- [ ] Реализовать логику загрузки сохраненных промтов из БД

### 3.3 Таблица результатов
- [ ] Создать QTableWidget для отображения результатов
- [ ] Настроить колонки:
  - Чекбокс (selected)
  - Название модели
  - Текст ответа
- [ ] Реализовать временное хранение результатов в памяти (список словарей)
- [ ] Добавить обработчик изменения чекбоксов
- [ ] Реализовать авто-обновление таблицы при получении новых ответов

### 3.4 Панель управления
- [ ] Добавить кнопку "Сохранить выбранные"
- [ ] Добавить кнопку "Очистить результаты"
- [ ] Добавить кнопку "Новый запрос"
- [ ] Реализовать обработчики для всех кнопок

### 3.5 Логика работы с запросами
- [ ] Реализовать метод `send_prompt()`:
  - Получение активных моделей из БД
  - Отправка промта во все модели через ModelManager
  - Обновление временной таблицы результатов
- [ ] Реализовать метод `save_selected_results()`:
  - Сохранение промта в таблицу prompts (если новый)
  - Сохранение выбранных результатов в таблицу results
  - Очистка временной таблицы
- [ ] Реализовать метод `clear_results()`:
  - Очистка временной таблицы
  - Обновление UI

## Этап 4: Управление моделями

### 4.1 Окно управления моделями
- [ ] Создать диалоговое окно `ModelSettingsDialog`
- [ ] Добавить таблицу со списком всех моделей
- [ ] Реализовать функции:
  - Добавление новой модели
  - Редактирование существующей модели
  - Удаление модели
  - Включение/отключение модели (чекбокс is_active)
- [ ] Добавить валидацию полей (api_url, api_id)

### 4.2 Интеграция с главным окном
- [ ] Добавить пункт меню "Настройки моделей"
- [ ] Подключить диалог к главному окну
- [ ] Реализовать обновление списка моделей после изменений

## Этап 5: Дополнительные функции

### 5.1 Поиск и сортировка
- [ ] Добавить поиск в таблице промтов (QLineEdit с фильтром)
- [ ] Добавить поиск в таблице результатов
- [ ] Реализовать сортировку по колонкам во всех таблицах
- [ ] Добавить фильтр по тегам для промтов

### 5.2 Экспорт данных
- [ ] Реализовать экспорт результатов в Markdown:
  - Форматирование с заголовками
  - Сохранение структуры (модель, ответ)
- [ ] Реализовать экспорт результатов в JSON:
  - Структурированный формат
  - Включение метаданных (дата, промт, теги)
- [ ] Добавить кнопку "Экспорт" в интерфейс
- [ ] Создать диалог выбора формата и пути сохранения

### 5.3 Логирование
- [ ] Настроить модуль logging
- [ ] Добавить логирование:
  - Запросов к API (успешных и неудачных)
  - Ошибок работы с БД
  - Действий пользователя
- [ ] Создать окно просмотра логов (опционально)

### 5.4 Настройки приложения
- [ ] Реализовать сохранение настроек в таблицу settings:
  - Путь для экспорта по умолчанию
  - Таймаут запросов
  - Размер окна и позиция
- [ ] Создать окно настроек
- [ ] Реализовать загрузку настроек при запуске

## Этап 6: Тестирование и доработка

### 6.1 Тестирование функциональности
- [ ] Протестировать работу с БД (создание, чтение, обновление, удаление)
- [ ] Протестировать отправку запросов к разным API
- [ ] Протестировать сохранение и загрузку результатов
- [ ] Протестировать экспорт в разные форматы

### 6.2 Обработка ошибок
- [ ] Добавить обработку ошибок подключения к API
- [ ] Добавить обработку ошибок работы с БД
- [ ] Добавить информативные сообщения об ошибках пользователю
- [ ] Реализовать graceful degradation при недоступности некоторых моделей

### 6.3 Оптимизация и рефакторинг
- [ ] Оптимизировать работу с БД (индексы, запросы)
- [ ] Улучшить производительность UI (обновление таблиц)
- [ ] Рефакторинг кода (выделение общих функций)
- [ ] Добавить комментарии и docstrings

## Этап 7: Финальная подготовка

### 7.1 Документация
- [ ] Создать README.md с инструкциями по установке и использованию
- [ ] Добавить примеры использования
- [ ] Описать формат .env файла

### 7.2 Упаковка
- [ ] Создать скрипт для создания .exe (PyInstaller, опционально)
- [ ] Подготовить финальную версию requirements.txt
- [ ] Проверить работу на чистой системе

